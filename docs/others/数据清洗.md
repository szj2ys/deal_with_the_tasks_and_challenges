
`map、applymap、apply用法 <https://zhuanlan.zhihu.com/p/100064394>`__

`常用函数详解 <https://zhuanlan.zhihu.com/p/106724730>`__


修改
====

修改列名`score`为`popularity`

```python3
df.rename(columns={'score':'popularity'}, inplace=True)
```

修改所有列名

```python3
df.columns = ['col1', 'col2', 'col3']
```


交换两列的位置

```python3
df = df[df.columns[[1,0]]]
df = df.iloc[:,[2,1,0]]
```

时间操作
======

修改日期显示格式

```python3
# createTime为datetime类型
df['createTime'] = df.createTime.apply(lambda x:datetime.datetime.strftime(x, '%m-%d'))
df.Year = pd.to_datetime(df.Year, format='%Y-%m-%d')
df['createTime'].dt.year
df['createTime'].dt.month
df['createTime'].dt.hour

df['createTime'].min()  # 最小时间
df['createTime'].max()  # 最大时间
```


修改数据类型

```python3
df['salary_avg'] = df['salary_avg'].astype(np.float64)
```


修改数值列的格式

```python3
# 创建一列一科学计数的dataframe
df = pd.DataFrame(np.random.random(10)**10, columns=['data'])
# 转换为保留3位小数
df.round(3)
# 转换为百分数
df.style.format({'data': '{0:.2%}'.format})
```


年月日错误处理

有日期数据错误，如下：

.. image:: https://github.com/szj2ys/deal_with_the_tasks_and_challenges/raw/main/datasets/resources/century_bug.png

```python3
def fix_century(x):
    year = x.year - 100 if x.year > 1989 else x.year
    return datetime.date(year, x.month, x.day)

# apply the function fix_century on the column and replace the values to the right ones
df['Yr_Mo_Dy'] = df['Yr_Mo_Dy'].apply(fix_century)
```


.. image:: https://github.com/szj2ys/deal_with_the_tasks_and_challenges/raw/main/datasets/resources/century_bug_fixed.png


行列转换

```python3
stack和unstack
```


增加
========

```python3
pass
```



合并
========

将两列数据合并成一列数据

```python3
# 两个str列相加操作是拼接，两个数值列可以进行算数操作
df['test'] = df['education']+df['createTime'].map(str)
```


提取
====

Airline列，有一些多余的标点符号，需要提取出正确的航司名称。举例：'(British Airways. )' 应该改为 'British Airways'

```python3
df['Airline'] = df['Airline'].str.extract('([a-zA-Z\s]+)', expand=False).str.strip()
```


`RecentDelays`列，数据被以列表的形式录入，但是我们希望每个数字被录入成单独一列，delay_1, delay_2, ...没有的用NAN替代

```python3
delays = df['RecentDelays'].apply(pd.Series)
delays.columns = ['delay_{}'.format(n) for n in range(1, len(delays.columns)+1)]
df = df.drop('RecentDelays', axis=1).join(delays)
```

计算
======

计算两列的欧氏距离

```python3
np.linalg.norm(df['col2']-df['col3'])
```





分段
=======

新增一列根据salary_avg将数据分组

```python3
bins = [0,14000,17500,25000,45000]
labels = ['低', '中', '高', '很高']
df['categories'] = pd.cut(df.salary_avg, bins=bins, labels=labels)
```




将空值用上下值的平均值填充

```python3
df['popularity'].fillna(df['popularity'].interpolate(), inplace=True)
```


缺失值填充

```python3
df.interpolate(method='linear', limit_direction='forward', axis=0)
```


按照grammer列进行去除重复值

```python3
df.drop_duplicates(subset='grammer')
```


将priority列中的yes, no替换为布尔值True, False

```python3
df['priority'] = df['priority'].map({'yes': True, 'no': False})
```


将animal列中的snake替换为python

```python3
df['animal'] = df['animal'].replace('snake', 'python')
```



删除
=====

删除最后一行数据

```python3
df.drop(len(df)-1, inplace=True)
```


删除所有缺失的行

```python3
'''
备注
axis：0-行操作（默认），1-列操作
how：any-只要有空值就删除（默认），all-全部为空值才删除
inplace：False-返回新的数据集（默认），True-在原数据集上操作
'''
df.dropna(axis=0, how='any', inplace=True)
```


删除数值重复的行

```python3
df.drop_duplicates(subset='A')
```


删除`categories`列

```python3
df.drop('categories', axis=1, inplace=True)
```


删除所有`换手率(%)`非数字的行

```python3
# 根据正则拿出所有非数字的行的下标  删除对应下标所在的行
df.drop(df[df['换手率(%)'].apply(lambda x :len(re.findall('^[0-9]+(\.?[0-9]+)?$', str(x))))<1].index, axis=0)
```



合并
======

`education`列和`salary_avg`列合并，只有str类型才行

```python3
df['edu_sal'] = df['education'] + df['salary_avg'].astype(str)
```







