时间序列是指在一定时间内按时间顺序测量的某个变量的取值序列。常见的时间序列数据有一天内随着时间变化的温度序列，又或者交易时间内不断波动的股票价格序列。

Pandas时序处理中最常见的两种数据类型为datetime和timedelta。

datetime顾名思义就是既有日期date也有时间time，表示一个具体的时间点（时间戳）。timedelta则表示两个时间点之间的差，比如2020-01-01和2020-01-02之间的timedelta即为一天。

### object转datetime，修改日期显示格式

```python3
import datetime

'''
df.date为object类型的日期，如 20200819
'''

# df.date转换成datetime
df['dated'] = pd.to_datetime(df.date, format='%Y-%m-%d')
# df.date转换成时间格式后转换成'%m-%d'格式
df['datetime_md'] = pd.to_datetime(df.dated.apply(lambda x:datetime.datetime.strftime(x, '%m-%d')), format='%m-%d')
# 直接把df.date转换成'%m-%d'格式
df['datestr_md'] = pd.to_datetime(df.date.apply(lambda x:datetime.datetime.strptime(x, "%Y-%m-%d").strftime("%m-%d")), format='%m-%d')

# df.date获取对应的年、月、日、时
df["date_year"] = pd.to_datetime(df.date).dt.year
df["date_month"] = pd.to_datetime(df.date).dt.month
df["date_day"] = pd.to_datetime(df.date).dt.day
df["date_hour"] = pd.to_datetime(df.date).dt.hour

# 获取时间统计结果
df['dated'].min()  # 最小时间
df['dated'].max()  # 最大时间
```

### 提取出时间/日期的属性
![](https://pic4.zhimg.com/v2-23e3dc880510d4a7791f58e9b5ff9dbf_r.jpg)

```python
df['day'] = df.trade_day.dt.day
```

### 时间序列的索引
```python
df = df.set_index("trade_date")
```


### 采样（resample）
resample翻译过来是重采样的意思，官方文档中是这么描述resample的
>resample() is a time-based groupby

翻译过来就是基于时间的groupby操作，我个人认为这是Pandas时间序列处理中最重要的功能，也是本文的重中之重。

根据采样是从低频到高频还是从高频到低频可以分为升采样和降采样两种方式，先来看看降采样是啥

#### 降采样
以一个实例来引入，我们使用的数据是上证指数2019年的日级别数据，如果现在想求每季度的平均收盘价，应该怎么操作呢？

从日级别数据求季度级别数据，是从高频到低频的聚合操作，其实就类似于groupby按季度进行操作，用resample来写是这样子

```python
df.resample('Q',on='trade_date')["close"].mean()
```

其中'Q'是以季度为频率进行采样，on指定datetime列（如果索引为Datetimeindex，则on不需要指定，默认依据索引进行降采样）。整个过程图解如下：

![](https://pic4.zhimg.com/v2-73ac37712f4037e89e6860dfc884971b_r.jpg)
整个过程其实就是一个groupby过程：

- 对原有的数据按照指定的频率进行切分，分到不同的group中
- 对不同的group执行操作
- 整合操作结果

其中，切分的频率可以为任何时间频率，可以为季度Q、月度M、星期W、N天ND，也可以为时H、分T，当然，如果切分后的频率小于原有的时间频率，就是我们下面要讲的升采样。

#### 升采样
当采样的频率低于原有的频率时，即为升采样。升采样是对原有的时间粒度更为细粒度的划分，所以升采样时会产生缺失值。下面取2019-01-02至2019-01-03的数据按照6H的频率演示一下：

```python
df.resample('6H').asfreq()
```
对resample后的结果应用.asfreq()会返回新频率下的结果。可以看到升采样后产生了缺失值。如果想要填充缺失值可以采用向后填充.bfill()或向前填充.ffill()的方式：

```python
# 向前填充，缺失值取2465.2910进行填充
In [1]: df.resample('6H').ffill()
Out[1]:
                         close
trade_date
2019-01-02 00:00:00  2465.2910
2019-01-02 06:00:00  2465.2910
2019-01-02 12:00:00  2465.2910
2019-01-02 18:00:00  2465.2910
2019-01-03 00:00:00  2464.3628

# 向后填充，缺失值取2464.3628进行填充
In [2]: df.resample('6H').bfill()
Out[2]:
                         close
trade_date
2019-01-02 00:00:00  2465.2910
2019-01-02 06:00:00  2464.3628
2019-01-02 12:00:00  2464.3628
2019-01-02 18:00:00  2464.3628
2019-01-03 00:00:00  2464.3628
```


总结一下resample，resample可以对原有的时间序列进行任何频率freq的采样，如果从低频到高频为升采样，高频到低频为降采样。整个操作过程和groupby基本一致，所以也可以对resample后的对象进行apply和transform等操作


